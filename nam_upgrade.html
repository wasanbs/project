<!DOCTYPE html>
<html lang="th" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แผนอัปเกรดระบบ NetIQ Access Manager - ไปรษณีย์ไทย</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fbff; /* Very light blue background */
            color: #3f3f46;
        }
        .bg-primary-blue { background-color: #0D94E8; } /* Busisoft header blue */
        .text-primary-blue { color: #0D94E8; }
        .border-primary-blue { border-color: #0D94E8; }
        .hover-bg-primary-blue-dark { background-color: #1A73E8; } /* Slightly darker blue for hover */

        .bg-medium-blue { background-color: #2196F3; } /* Material Blue 500 */
        .text-medium-blue { color: #2196F3; }

        .bg-light-blue { background-color: #E3F2FD; } /* Material Blue 50 */
        .text-light-blue { color: #E3F2FD; }

        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            font-weight: 600; /* Make navigation links bold */
        }
        .nav-link:hover {
            color: #2196F3; /* Medium Blue on hover */
        }
        .nav-link.active {
            color: #0D94E8; /* Primary Blue for active */
            border-bottom-color: #0D94E8;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2196F3;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Timeline specific styles */
        .project-timeline {
            position: relative;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 20px;
            margin-top: 20px;
        }
        .timeline-axis {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* gray-500 */
            padding-left: 270px; /* Adjusted space for labels to align axis */
            padding-right: 10px;
        }
        .timeline-track {
            display: flex;
            align-items: center;
            height: 40px;
            margin-bottom: 10px;
            background-color: #f3f4f6; /* gray-100 */
            border-radius: 5px;
            position: relative;
        }
        .timeline-label-area {
            flex-shrink: 0;
            width: 250px; /* Fixed width for the label area */
            padding-left: 10px; /* Padding from the left edge of the track */
            padding-right: 10px; /* Padding between label and bar area */
            text-align: left; /* Align text to the left for clarity */
            font-size: 0.875rem; /* text-sm */
            color: #3f3f46; /* text-gray-800 */
            white-space: normal; /* Allow text to wrap */
            overflow: visible; /* Ensure text is not hidden */
            text-overflow: unset; /* Prevent ellipsis */
            box-sizing: border-box;
            word-break: break-word; /* Break long words */
        }
        .timeline-chart-area {
            flex-grow: 1;
            position: relative; /* Container for absolute positioned bars */
            height: 100%; /* Take full height of track */
        }
        .timeline-bar {
            height: 30px;
            border-radius: 3px;
            position: absolute; /* Positioned within timeline-chart-area */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; /* text-xs */
            color: white;
            padding: 0 5px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 5;
        }
        .timeline-bar.status-NotStarted { background-color: #9ca3af; /* gray-400 */ }
        .timeline-bar.status-InProgress { background-color: #2196F3; /* medium-blue */ }
        .timeline-bar.status-Completed { background-color: #10b981; /* green-500 */ }

        /* Version Details styles */
        .version-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .version-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .version-card.active {
            border-color: #0D94E8;
            background-color: #E3F2FD;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .data-management-button {
            transition: all 0.2s ease-in-out;
        }
        .data-management-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-xl font-bold text-primary-blue">ไปรษณีย์ไทย</div>
            <div class="hidden md:flex space-x-8">
                <a href="#overview" class="nav-link border-b-2 border-transparent">ภาพรวม</a>
                <a href="#progress" class="nav-link border-b-2 border-transparent">ความคืบหน้า</a>
                <a href="#improvements" class="nav-link border-b-2 border-transparent">การปรับปรุง</a>
                <a href="#version-details" class="nav-link border-b-2 border-transparent">รายละเอียดเวอร์ชัน</a>
                <a href="#benefits" class="nav-link border-b-2 border-transparent">ประโยชน์</a>
                <a href="#risks" class="nav-link border-b-2 border-transparent">ความเสี่ยง</a>
                <a href="#approval" class="nav-link border-b-2 border-transparent">ข้อเสนอแนะ</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8 md:py-12">

        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">แผนอัปเกรดระบบ NetIQ Access Manager (NAM)</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">ปรับปรุงแผนการอัปเกรดสู่เวอร์ชันล่าสุดบนระบบจริง (Production) โดยตรง พร้อมเพิ่มขั้นตอนการติดตามผล (Follow-up) เพื่อสร้างความมั่นใจและลดผลกระทบต่อผู้ใช้งาน</p>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ภาพรวมโครงการ</h2>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">สถานะปัจจุบันของระบบ</h3>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Access Manager (NAM):</strong> เวอร์ชัน 4.5.3, ระบบปฏิบัติการ SUSE Linux 12 SP4</div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Advanced Authentication (AA):</strong> <span class="font-bold text-green-600">ดำเนินการเสร็จสิ้นเรียบร้อยแล้ว</span></div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>ข้อจำกัดเดิม:</strong> อาจมีช่องโหว่ความปลอดภัยที่ยังไม่ถูกแก้ไข, ขาดคุณสมบัติใหม่ๆ, และส่วนประกอบพื้นฐานเริ่มล้าสมัย</div></li>
                    </ul>
                </div>
                <div class="bg-primary-blue text-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold mb-4">เป้าหมายโครงการ</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>เวอร์ชัน NAM เป้าหมาย:</strong> NetIQ Access Manager 5.1</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>ระบบปฏิบัติการเป้าหมาย:</strong> SUSE Linux 12 SP5</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>การบูรณาการ:</strong> เพิ่ม NetIQ Advanced Authentication (AA) สำหรับ MFA และ Adaptive Authentication</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>ผลลัพธ์:</strong> ระบบที่ปลอดภัย ทันสมัย เสถียร และพร้อมสำหรับอนาคต</div></li>
                    </ul>
                </div>
            </div>
             <p class="text-center mt-8 text-gray-600">โครงการนี้มีเป้าหมายเพื่อทำให้ระบบจัดการการเข้าถึง (NAM) ของไปรษณีย์ไทยทันสมัยขึ้น เพื่อให้ระบบมีความปลอดภัยและทำงานได้ดียิ่งขึ้น นอกจากนี้ เราจะเพิ่ม NetIQ Advanced Authentication (AA) เข้ามา เพื่อเสริมความปลอดภัยในการยืนยันตัวตนให้มีหลายชั้น (MFA) และสามารถปรับระดับความปลอดภัยตามความเสี่ยงได้</p>
        </section>

        <!-- Progress Tracking Section -->
        <section id="progress" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">การติดตามความคืบหน้าแผนการอัปเกรด</h2>
            
            <!-- Data Management Buttons -->
            <div class="bg-white rounded-xl shadow-md border border-gray-100 p-4 mb-6 flex flex-wrap justify-center items-center gap-4">
                 <h3 class="text-lg font-semibold text-gray-700 mr-4">จัดการข้อมูลแผนงาน:</h3>
                 <button onclick="downloadDataAsJson()" class="data-management-button bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                     บันทึกข้อมูลเป็นไฟล์
                 </button>
                 <label for="uploadJsonInput" class="data-management-button bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer">
                     โหลดข้อมูลจากไฟล์
                 </label>
                 <input type="file" id="uploadJsonInput" accept=".json" class="hidden" onchange="handleFileUpload(event)" />
                 <button onclick="resetData()" class="data-management-button bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">
                     รีเซ็ตข้อมูลเริ่มต้น
                 </button>
                 <div id="data-status-indicator" class="text-sm text-gray-500 ml-4"></div>
            </div>

            <!-- Unified container for Table and Timeline -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-light-blue">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ลำดับ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ขั้นตอน</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ผู้รับผิดชอบ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">วันที่เริ่มต้น</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">วันที่สิ้นสุด</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">สถานะ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>

                <h3 class="text-2xl font-bold text-center mt-12 mb-8 border-t pt-8">แผนภาพ Timeline โครงการ</h3>
                <div id="project-timeline" class="relative">
                    <div class="project-timeline">
                        <div id="timeline-axis" class="timeline-axis"></div>
                        <div id="timeline-tracks">
                            <!-- Task tracks and bars will be injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="improvements" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-4">การปรับปรุงที่สำคัญ</h2>
            <p class="text-center max-w-2xl mx-auto mb-12 text-gray-600">การอัปเกรดครั้งนี้มุ่งเน้นการพัฒนาใน 3 ด้านหลัก คลิกที่ส่วนของแผนภูมิเพื่อดูรายละเอียด</p>
            <div class="grid lg:grid-cols-2 gap-8 items-center">
                <div class="chart-container">
                    <canvas id="improvementsChart"></canvas>
                </div>
                <div id="improvements-details" class="bg-white p-6 rounded-lg shadow-md border border-gray-100 min-h-[300px]">
                    <p class="text-gray-500 text-center flex items-center justify-center h-full">กรุณาเลือกส่วนในแผนภูมิเพื่อดูข้อมูล...</p>
                </div>
            </div>
        </section>

        <section id="version-details" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">รายละเอียดเวอร์ชันระบบ</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="version-selection-area">
                </div>
            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 min-h-[300px]" id="version-details-display">
                <p class="text-gray-500 text-center flex items-center justify-center h-full">กรุณาเลือกเวอร์ชันเพื่อดูรายละเอียด...</p>
            </div>
        </section>

        <section id="benefits" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ประโยชน์ที่คาดว่าจะได้รับ</h2>
            <div id="benefits-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </section>

        <section id="risks" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ผลกระทบและความเสี่ยงที่อาจเกิดขึ้น</h2>
            <div id="risks-container" class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-100 space-y-6">
                </div>
        </section>

        <section id="approval" class="pt-16 -mt-16">
             <h2 class="text-3xl font-bold text-center mb-12">ข้อแนะนำและการอนุมัติ</h2>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-2xl font-semibold mb-6">ข้อแนะนำเพื่อความสำเร็จของโครงการ</h3>
                <div id="recommendations-container" class="space-y-4">
                     </div>
                <div class="mt-12 pt-8 border-t">
                    <h3 class="text-2xl font-semibold mb-4 text-center">การอนุมัติ (บริษัท ไปรษณีย์ไทย จำกัด)</h3>
                    <div class="flex flex-wrap justify-center gap-4 mt-6">
                        <button class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg">อนุมัติแล้ว</button>
                        <button class="bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg">ดำเนินการในภายหลัง</button>
                        <button class="bg-red-100 text-red-700 font-bold py-3 px-6 rounded-lg">ไม่ต้องการดำเนินการ</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-4 text-center text-sm">
            <p>โครงการบริการบำรุงรักษาระบบบริหารจัดการการเข้าถึงระบบสารสนเทศ ปณท (IDM)</p>
            <p>Last update | วันที่: 20 มิถุนายน 2568</p>
        </div>
    </footer>

<script type="module">
    // --- Data Definitions ---
    
    // Default/Initial data (Revised for Production upgrade with follow-up steps)
    const defaultUpgradeSteps = [
        { id: "step-aa", title: "ติดตั้งและปรับแต่ง NetIQ (AA)", description: "ดำเนินการติดตั้งและปรับแต่ง NetIQ Advanced Authentication", version: "AA", startDate: "2025-05-01", endDate: "2025-05-20", status: "Completed", assignee: "Busisoft", order: 0 },
        { id: "step-2-upgrade", title: "อัปเกรด NAM v4.5.5 (Production)", description: "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชัน 4.5.5", version: "v4.5.5", startDate: "2025-09-08", endDate: "2025-09-14", status: "Not Started", assignee: "Busisoft", order: 1 },
        { id: "step-2-followup", title: "ติดตามผล NAM v4.5.5", description: "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", version: "v4.5.5", startDate: "2025-09-15", endDate: "2025-09-21", status: "Not Started", assignee: "Busisoft/THP", order: 2 },
        { id: "step-3-upgrade", title: "อัปเกรด SUSE Linux 12 SP5 (Production)", description: "ดำเนินการอัปเกรดระบบปฏิบัติการ SUSE Linux บนระบบจริง", version: "SUSE Linux 12 SP5", startDate: "2025-09-22", endDate: "2025-09-28", status: "Not Started", assignee: "Busisoft", order: 3 },
        { id: "step-3-followup", title: "ติดตามผล SUSE Linux 12 SP5", description: "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", version: "SUSE Linux 12 SP5", startDate: "2025-09-29", endDate: "2025-10-05", status: "Not Started", assignee: "Busisoft/THP", order: 4 },
        { id: "step-4-upgrade", title: "อัปเกรด NAM v5.0.3 (Production)", description: "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชัน 5.0.3", version: "v5.0.3", startDate: "2025-10-06", endDate: "2025-10-12", status: "Not Started", assignee: "Busisoft", order: 5 },
        { id: "step-4-followup", title: "ติดตามผล NAM v5.0.3", description: "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", version: "v5.0.3", startDate: "2025-10-13", endDate: "2025-10-19", status: "Not Started", assignee: "Busisoft/THP", order: 6 },
        { id: "step-5-upgrade", title: "อัปเกรด NAM v5.1 (Production)", description: "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชันเป้าหมาย 5.1", version: "v5.1", startDate: "2025-10-20", endDate: "2025-10-26", status: "Not Started", assignee: "Busisoft", order: 7 },
        { id: "step-5-followup", title: "ติดตามผล NAM v5.1", description: "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", version: "v5.1", startDate: "2025-10-27", endDate: "2025-11-02", status: "Not Started", assignee: "Busisoft/THP", order: 8 },
        { id: "step-7-final", title: "สรุปผลและส่งมอบโครงการ", description: "รวบรวมข้อมูล สรุปผลการดำเนินงาน และส่งมอบโครงการ", version: "v5.1", startDate: "2025-11-03", endDate: "2025-11-09", status: "Not Started", assignee: "Busisoft", order: 9 }
    ];

    // Main data variable. This will hold the current state.
    let upgradeSteps = [];

    const improvementsChartData = {
        labels: ['ความปลอดภัย', 'ประสิทธิภาพ', 'คุณสมบัติใหม่'],
        datasets: [{
            data: [60, 25, 15],
            backgroundColor: ['#0D94E8', '#2196F3', '#64B5F6'],
            hoverBackgroundColor: ['#1A73E8', '#1976D2', '#42A5F5'],
            borderColor: '#f8fbff',
            borderWidth: 4
        }]
    };
    
    // Other data remains the same...
    const benefitsData = [ { icon: '🛡️', title: 'ความปลอดภัยแข็งแกร่งขึ้น', description: 'แก้ไขช่องโหว่สำคัญ รองรับการยืนยันตัวตนสมัยใหม่ และเพิ่ม MFA เพื่อป้องกันการเข้าถึงที่ไม่ได้รับอนุญาต' }, { icon: '⚡', title: 'ประสิทธิภาพและความเสถียร', description: 'อัปเดตส่วนประกอบพื้นฐานทำให้ระบบทำงานเร็วขึ้น ลดความเสี่ยงจากปัญหาทางเทคนิคและมีความน่าเชื่อถือสูง' }, { icon: '⚙️', title: 'บริหารจัดการง่ายและยืดหยุ่น', description: 'ด้วยหน้าจอจัดการใหม่และ REST APIs ที่ดีขึ้น ช่วยลดภาระงานของทีม IT และทำงานอัตโนมัติได้มากขึ้น' }, { icon: '🤝', title: 'ประสบการณ์ผู้ใช้ที่ดีขึ้น', description: 'Single Sign-On (SSO) ที่มีประสิทธิภาพช่วยให้ผู้ใช้เข้าถึงแอปพลิเคชันต่างๆ ได้อย่างราบรื่นและสะดวกสบาย' }, { icon: '🌍', title: 'รองรับการทำงานยุคใหม่', description: 'การเพิ่ม AA ช่วยให้รองรับการทำงานนอกสถานที่ (Mobile Workforce) และการ Login แบบ Offline ได้อย่างปลอดภัย' }, { icon: '🚀', title: 'พร้อมสำหรับอนาคต', description: 'ระบบที่ทันสมัยพร้อมรองรับเทคโนโลยีใหม่ๆ และการเปลี่ยนแปลงทางธุรกิจในอนาคตได้อย่างมั่นใจ' } ];
    const risksData = [ { title: 'ความซับซ้อนในการดำเนินการ', description: 'ระบบ IAM มีความซับซ้อนในการตั้งค่า ซึ่งอาจนำไปสู่ข้อผิดพลาดได้', mitigation: 'ดำเนินการแบบขั้นบันไดในระบบแยก (วงปิด) และทดสอบอย่างละเอียดโดยทีมผู้เชี่ยวชาญ' }, { title: 'ปัญหาความเข้ากันได้ของระบบ', description: 'ส่วนประกอบต่างๆ อาจมีปัญหาความเข้ากันไม่ได้ โดยเฉพาะการอัปเกรดระบบปฏิบัติการ', mitigation: 'ปฏิบัติตามข้อกำหนดของผลิตภัณฑ์อย่างเคร่งครัด (เช่น อัปเกรด SUSE Linux ก่อน) และทดสอบการทำงานร่วมกันอย่างละเอียด' }, { title: 'ผลกระทบต่อผู้ใช้งาน', description: 'การเปลี่ยนแปลงระบบอาจสร้างความสับสนให้ผู้ใช้งานในช่วงแรก', mitigation: 'วางแผนการสื่อสารและจัดทำคู่มือให้ผู้ใช้ทราบล่วงหน้า โดยเฉพาะการเปลี่ยนแปลงเรื่องการยืนยันตัวตน (MFA)' } ];
    const recommendationsData = [ "ควรมีการวางแผนโครงการที่ละเอียดรอบคอบ จัดสรรทรัพยากรที่เพียงพอ และบริหารจัดการความเสี่ยงอย่างต่อเนื่อง", "การทดสอบในสภาพแวดล้อมแยกควรครอบคลุมทุกด้าน ทั้งการทำงาน ประสิทธิภาพ และความปลอดภัย เพื่อให้มั่นใจก่อนนำไปใช้จริง", "ควรมีการสื่อสารที่ชัดเจนไปยังผู้ใช้งานเกี่ยวกับประโยชน์และการเปลี่ยนแปลงที่อาจเกิดขึ้น โดยเฉพาะการนำ MFA มาใช้", "หลังการอัปเกรด ควรมีการตรวจสอบประสิทธิภาพและความปลอดภัยของระบบอย่างต่อเนื่อง เพื่อให้มั่นใจว่าระบบทำงานได้ตามที่คาดหวัง" ];
    const versionDetailsData = [ { id: "aa", name: "NetIQ Advanced Authentication (AA)", summary: "NetIQ Advanced Authentication (AA) ได้รับการติดตั้งและปรับแต่งเพื่อเพิ่มความสามารถในการยืนยันตัวตนขั้นสูง", details: [ "รองรับ Multi-Factor Authentication (MFA) หลากหลายรูปแบบ เช่น รหัสผ่านครั้งเดียว (OTP), Biometrics (ลายนิ้วมือ, ใบหน้า), Push Notifications", "เพิ่ม Adaptive Authentication Policy: สามารถกำหนดนโยบายความปลอดภัยที่ปรับเปลี่ยนได้ตามบริบทการเข้าถึง", "ลดความเสี่ยงจากการเข้าถึงโดยไม่ได้รับอนุญาต", "ปรับปรุงประสบการณ์ผู้ใช้", "รองรับมาตรฐานความปลอดภัยล่าสุด" ] }, { id: "v4.5.3", name: "NetIQ Access Manager 4.5.3 (เวอร์ชันปัจจุบัน)", summary: "เวอร์ชันปัจจุบันของ NAM ที่กำลังใช้งานอยู่และกำลังจะได้รับการอัปเกรด", details: [ "ระบบปฏิบัติการ: SUSE Linux Enterprise Server 12 SP4 ซึ่งใกล้จะหมดอายุการสนับสนุน", "ส่วนประกอบพื้นฐาน: Apache, Tomcat, OpenSSL (เวอร์ชันเก่า)", "ช่องโหว่ความปลอดภัย: อาจมีช่องโหว่ที่ยังไม่ถูกแก้ไข", "คุณสมบัติ: ขาดคุณสมบัติใหม่ๆ", "ความซับซ้อนในการจัดการ: หน้าจอแบบเดิม" ] }, { id: "v4.5.5", name: "NetIQ Access Manager 4.5.5 (Patch Update)", summary: "การอัปเกรดแพตช์สำหรับ NAM 4.5.x เพื่อปรับปรุงพื้นฐานและแก้ไขช่องโหว่เร่งด่วน", details: [ "อัปเดตส่วนประกอบ: Tomcat 8.5.72, OpenSSL 1.0.2za, Apache 2.4.51", "แก้ไขปัญหาความปลอดภัย: ปรับปรุงการจัดการอักขระพิเศษ", "แก้ไขช่องโหว่ SAML", "ปรับปรุงความเสถียร" ] }, { id: "v5.0.3", name: "NetIQ Access Manager 5.0.3 (Major Update)", summary: "การอัปเกรดเวอร์ชันหลักที่มาพร้อมคุณสมบัติใหม่และการแก้ไขช่องโหว่ที่สำคัญ", details: [ "รองรับ Kerberos Privileged Attribute Certificate (PAC)", "แก้ไขช่องโหว่ Log4j (CVE-2021-44228)", "แก้ไขช่องโหว่ Multiple XSS (CVE-2022-26325)", "อัปเดตส่วนประกอบ: Tomcat 9.0.65, Apache 2.4.54", "ปรับปรุงประสิทธิภาพ" ] }, { id: "v5.1", name: "NetIQ Access Manager 5.1 (Target Version)", summary: "เวอร์ชันเป้าหมายที่มีการปรับปรุงครั้งใหญ่ด้านการจัดการ ความปลอดภัย และ REST APIs", details: [ "Enhanced Administration Console (Angular UI)", "ปรับปรุง REST APIs สำหรับ Automation", "แก้ไขช่องโหว่ความปลอดภัยเพิ่มเติม: Directory Traversal, User Impersonation, XSS", "ความสามารถในการบูรณาการที่ดีขึ้น", "รองรับมาตรฐาน OpenID Connect/OAuth 2.0", "ลด Downtime ในการอัปเกรด" ] }, { id: "suse-12-sp5", name: "SUSE Linux Enterprise Server 12 SP5", summary: "Service Pack ล่าสุดสำหรับ SUSE Linux 12", details: [ "แพตช์ความปลอดภัยล่าสุด", "การปรับปรุงประสิทธิภาพ", "รองรับฮาร์ดแวร์ที่อัปเดตแล้ว", "เพิ่มความเสถียร" ] } ];

    // --- Data Persistence Functions ---

    function saveDataToLocalStorage() {
        try {
            localStorage.setItem('netiqUpgradePlanData', JSON.stringify(upgradeSteps));
            updateDataStatusIndicator(true);
        } catch (error) {
            console.error("Error saving data:", error);
            updateDataStatusIndicator(false, "เกิดข้อผิดพลาดในการบันทึก");
        }
    }

    function loadDataFromLocalStorage() {
        try {
            const savedData = localStorage.getItem('netiqUpgradePlanData');
            upgradeSteps = savedData ? JSON.parse(savedData) : JSON.parse(JSON.stringify(defaultUpgradeSteps));
            updateDataStatusIndicator(!!savedData, savedData ? "" : "ใช้ข้อมูลเริ่มต้น");
        } catch (error) {
            console.error("Error loading data:", error);
            upgradeSteps = JSON.parse(JSON.stringify(defaultUpgradeSteps));
            updateDataStatusIndicator(false, "ข้อมูลที่บันทึกไว้เสียหาย");
        }
    }
    
    function updateDataStatusIndicator(isSaved, message = '') {
        const indicator = document.getElementById('data-status-indicator');
        if (!indicator) return;
        if (isSaved && !message) {
            indicator.textContent = `บันทึกอัตโนมัติเมื่อ: ${new Date().toLocaleTimeString()}`;
            indicator.className = 'text-sm text-green-600 ml-4';
        } else {
            indicator.textContent = message;
            indicator.className = 'text-sm text-yellow-600 ml-4';
        }
    }

    window.downloadDataAsJson = function() {
        try {
            const dataStr = JSON.stringify(upgradeSteps, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'netiq_upgrade_plan.json';
            a.click();
            URL.revokeObjectURL(url);
        } catch (error) {
            alert("ไม่สามารถสร้างไฟล์สำหรับดาวน์โหลดได้");
        }
    }

    window.handleFileUpload = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (Array.isArray(importedData)) {
                    upgradeSteps = importedData;
                    saveDataToLocalStorage();
                    rerenderAll();
                    alert("โหลดข้อมูลจากไฟล์สำเร็จแล้ว");
                } else {
                    throw new Error("ไฟล์ JSON ไม่ใช่รูปแบบที่ถูกต้อง (ต้องเป็น Array)");
                }
            } catch (error) {
                alert(`เกิดข้อผิดพลาด: ${error.message}`);
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    window.resetData = function() {
        if (confirm("คุณต้องการลบข้อมูลที่แก้ไขทั้งหมดและกลับไปใช้ข้อมูลเริ่มต้นหรือไม่?")) {
            localStorage.removeItem('netiqUpgradePlanData');
            loadDataFromLocalStorage();
            rerenderAll();
            alert("รีเซ็ตข้อมูลเป็นค่าเริ่มต้นเรียบร้อยแล้ว");
        }
    }

    // --- Core Application Functions ---
    
    function rerenderAll() {
        renderProgressTable();
        renderProjectTimeline();
    }
    
    function initializeApplication() {
        loadDataFromLocalStorage();
        rerenderAll();
        
        createImprovementsChart();
        renderVersionSelection(); 
        renderBenefits();
        renderRisks();
        renderRecommendations();

        updateImprovementsDetails('ความปลอดภัย');
        setTimeout(() => {
            const initialVersionCard = document.querySelector(`[data-version-id="v5.1"]`);
            if (initialVersionCard) displayVersionDetails('v5.1', initialVersionCard);
        }, 100);
    }

    window.updateTaskDataAndRenderUI = (taskId, field, value) => {
        const taskIndex = upgradeSteps.findIndex(task => task.id === taskId);
        if (taskIndex > -1) {
            upgradeSteps[taskIndex][field] = value;
            upgradeSteps[taskIndex].lastUpdated = new Date().toISOString();
        }
        upgradeSteps.sort((a, b) => a.order - b.order);
        saveDataToLocalStorage();
        rerenderAll();
    };

    function renderProgressTable() {
        const tableBody = document.getElementById('progress-table-body');
        if (!tableBody) return;
        tableBody.innerHTML = '';
        const sortedSteps = [...upgradeSteps].sort((a, b) => a.order - b.order);
        sortedSteps.forEach((step, index) => {
            const row = document.createElement('tr');
            row.classList.add('hover:bg-gray-50');
            let statusColorClass = 'text-gray-500';
            if (step.status === 'Completed') statusColorClass = 'text-green-600 font-semibold';
            else if (step.status === 'In Progress') statusColorClass = 'text-blue-600 font-semibold';
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <div class="font-semibold">${step.title}</div>
                    <div class="text-xs text-gray-500">${step.description}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${step.assignee || 'N/A'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <input type="date" value="${step.startDate || ''}" class="border rounded px-2 py-1 text-sm w-36" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'startDate', this.value)" ${step.status === 'Completed' ? 'disabled' : ''}>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <input type="date" value="${step.endDate || ''}" class="border rounded px-2 py-1 text-sm w-36" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'endDate', this.value)" ${step.status === 'Completed' ? 'disabled' : ''}>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm ${statusColorClass}">
                    <select class="border rounded px-2 py-1 text-sm ${statusColorClass}" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'status', this.value)" ${step.id === 'step-aa' ? 'disabled' : ''}>
                        <option value="Not Started" ${step.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                        <option value="In Progress" ${step.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Completed" ${step.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    </select>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="alert('Last updated: ${step.lastUpdated ? new Date(step.lastUpdated).toLocaleString() : 'N/A'}');" class="text-blue-600 hover:text-blue-900 text-xs">Info</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    /**
     * Renders the project timeline (NOW RESPONSIVE).
     */
    function renderProjectTimeline() {
        const timelineWrapper = document.getElementById('project-timeline');
        const timelineAxis = timelineWrapper.querySelector('.timeline-axis'); 
        const timelineTracks = timelineWrapper.querySelector('#timeline-tracks');
        if (!timelineAxis || !timelineTracks) return;

        timelineAxis.innerHTML = '';
        timelineTracks.innerHTML = '';

        if (upgradeSteps.length === 0) {
            timelineTracks.innerHTML = '<div class="text-center py-4 text-gray-500">ไม่มีข้อมูล Timeline</div>';
            return;
        }
        
        // Make the timeline chart area responsive
        const labelAreaWidth = 270; // Fixed width for labels + padding
        const containerWidth = timelineWrapper.offsetWidth;
        const chartAreaWidth = containerWidth > labelAreaWidth ? containerWidth - labelAreaWidth : 500; // Fallback width

        const sortedSteps = [...upgradeSteps].sort((a, b) => a.order - b.order);
        const validDates = sortedSteps.filter(s => s.startDate && s.endDate).flatMap(s => [new Date(s.startDate).getTime(), new Date(s.endDate).getTime()]);
        
        let projectStartDate, projectEndDate;
        if (validDates.length > 0) {
            projectStartDate = new Date(Math.min(...validDates));
            projectEndDate = new Date(Math.max(...validDates));
        } else {
            projectStartDate = new Date(2025, 3, 1);
            projectEndDate = new Date(2025, 8, 30);
        }
        projectEndDate.setMonth(projectEndDate.getMonth() + 1);

        const totalProjectDurationMs = projectEndDate.getTime() - projectStartDate.getTime();
        
        let currentMonth = new Date(projectStartDate.getFullYear(), projectStartDate.getMonth(), 1);
        const monthFormat = { month: 'short', year: 'numeric' };
        let axisContent = '';
        while (currentMonth.getTime() <= projectEndDate.getTime()) {
            const nextMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
            const monthDurationMs = nextMonth.getTime() - currentMonth.getTime();
            const monthWidth = Math.max(0, chartAreaWidth * (monthDurationMs / totalProjectDurationMs));
            axisContent += `<div style="width: ${monthWidth}px; text-align: center; flex-shrink: 0;">${currentMonth.toLocaleString('th-TH', monthFormat)}</div>`;
            currentMonth = nextMonth;
        }
        timelineAxis.innerHTML = axisContent;
        timelineAxis.style.width = `${chartAreaWidth}px`;

        sortedSteps.forEach((step) => {
            const track = document.createElement('div');
            track.className = 'timeline-track';
            const taskLabel = document.createElement('div');
            taskLabel.className = 'timeline-label-area';
            taskLabel.textContent = step.title;
            track.appendChild(taskLabel);

            const chartArea = document.createElement('div');
            chartArea.className = 'timeline-chart-area';
            const bar = document.createElement('div');
            const stepStartDate = new Date(step.startDate);
            const stepEndDate = new Date(step.endDate);
            const offsetMs = stepStartDate.getTime() - projectStartDate.getTime();
            const durationMs = stepEndDate.getTime() - stepStartDate.getTime();
            const leftPositionPx = (offsetMs / totalProjectDurationMs) * chartAreaWidth;
            const widthPx = (durationMs / totalProjectDurationMs) * chartAreaWidth;
            bar.className = `timeline-bar status-${step.status.replace(/\s/g, '')}`;
            bar.style.left = `${leftPositionPx}px`;
            bar.style.width = `${Math.max(widthPx, 20)}px`;
            bar.title = `${step.title}\nสถานะ: ${step.status}\nเริ่ม: ${step.startDate}\nสิ้นสุด: ${step.endDate}`;
            chartArea.appendChild(bar);
            track.appendChild(chartArea);
            timelineTracks.appendChild(track);
        });
        timelineTracks.style.width = `calc(250px + ${chartAreaWidth}px)`;
    }

    // Other rendering functions (unchanged logic)
    function createImprovementsChart() { const ctx = document.getElementById('improvementsChart'); if (!ctx) return; if (window.improvementsChartInstance) { window.improvementsChartInstance.destroy(); } const chart = new Chart(ctx, { type: 'doughnut', data: improvementsChartData, options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { padding: 20, font: { size: 14, family: "'Sarabun', sans-serif" } } }, tooltip: { titleFont: { family: "'Sarabun', sans-serif" }, bodyFont: { family: "'Sarabun', sans-serif" } } }, onClick: (event, elements) => { if (elements.length > 0) { updateImprovementsDetails(improvementsChartData.labels[elements[0].index]); } } } }); window.improvementsChartInstance = chart; }
    function updateImprovementsDetails(category) { const container = document.getElementById('improvements-details'); if (!container) return; let content = `<h3 class="font-bold text-xl mb-4 text-primary-blue">${category}</h3><ul class="list-disc list-inside text-gray-700 space-y-2">`; switch (category) { case 'ความปลอดภัย': content += `<li>แก้ไขช่องโหว่ความปลอดภัยที่พบในเวอร์ชันก่อนหน้า (เช่น Log4j, XSS)</li><li>รองรับการยืนยันตัวตนแบบ Multi-Factor Authentication (MFA) ด้วย NetIQ AA</li><li>เพิ่มความสามารถในการตรวจสอบและควบคุมการเข้าถึงที่ละเอียดอ่อนยิ่งขึ้น</li><li>อัปเดตส่วนประกอบพื้นฐาน (Tomcat, OpenSSL, Apache) ให้เป็นเวอร์ชันที่ปลอดภัย</li>`; break; case 'ประสิทธิภาพ': content += `<li>ปรับปรุงความเร็วในการประมวลผลและการตอบสนองของระบบ</li><li>ลดภาระงานของ Server ด้วยการจัดการทรัพยากรที่ดีขึ้น</li><li>เพิ่มความเสถียรและความน่าเชื่อถือในการทำงานต่อเนื่อง</li>`; break; case 'คุณสมบัติใหม่': content += `<li>หน้าจอจัดการผู้ดูแลระบบ (Administration Console) ที่ทันสมัยขึ้นบน Angular UI</li><li>ปรับปรุงและเพิ่มประสิทธิภาพ REST APIs สำหรับการทำงานอัตโนมัติ</li><li>รองรับ Kerberos Privileged Attribute Certificate (PAC)</li><li>บูรณาการกับ NetIQ Advanced Authentication (AA) ได้อย่างสมบูรณ์แบบ</li>`; break; default: content += `<li>ไม่พบรายละเอียดสำหรับหมวดหมู่นี้</li>`; } content += `</ul>`; container.innerHTML = content; }
    function renderVersionSelection() { const selectionArea = document.getElementById('version-selection-area'); if (!selectionArea) return; selectionArea.innerHTML = ''; versionDetailsData.filter(v => v.id !== 'suse-12-sp5').forEach(version => { const cardDiv = document.createElement('div'); cardDiv.className = 'bg-white p-4 rounded-lg shadow-md border border-gray-200 version-card'; cardDiv.setAttribute('data-version-id', version.id); cardDiv.onclick = () => window.displayVersionDetails(version.id, cardDiv); cardDiv.innerHTML = `<h3 class="text-lg font-semibold text-gray-800 mb-1">${version.name}</h3><p class="text-sm text-gray-600">${version.summary}</p>`; selectionArea.appendChild(cardDiv); }); }
    window.displayVersionDetails = function(versionId, clickedElement) { const displayArea = document.getElementById('version-details-display'); if (!displayArea) return; document.querySelectorAll('.version-card').forEach(card => { card.classList.remove('active'); }); if (clickedElement) { clickedElement.classList.add('active'); } else { const cardToActivate = document.querySelector(`[data-version-id="${versionId}"]`); if (cardToActivate) { cardToActivate.classList.add('active'); } } const selectedVersion = versionDetailsData.find(v => v.id === versionId); if (selectedVersion) { let content = `<h3 class="font-bold text-xl mb-4 text-primary-blue">${selectedVersion.name}</h3><p class="text-gray-700 mb-4">${selectedVersion.summary}</p><h4 class="font-semibold text-lg text-gray-800 mb-2">รายละเอียด:</h4><ul class="list-disc list-inside text-gray-700 space-y-2">`; selectedVersion.details.forEach(detail => { content += `<li>${detail}</li>`; }); content += `</ul>`; displayArea.innerHTML = content; } else { displayArea.innerHTML = `<p class="text-red-500 text-center">ไม่พบรายละเอียดสำหรับเวอร์ชันนี้</p>`; } }
    function renderBenefits() { const container = document.getElementById('benefits-container'); if (!container) return; container.innerHTML = benefitsData.map(item => `<div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex items-start space-x-4"><div class="text-4xl leading-none">${item.icon}</div><div><h3 class="text-xl font-semibold mb-2 text-gray-800">${item.title}</h3><p class="text-gray-600">${item.description}</p></div></div>`).join(''); }
    function renderRisks() { const container = document.getElementById('risks-container'); if (!container) return; container.innerHTML = risksData.map(item => `<div class="p-6 rounded-lg bg-red-50 border border-red-200"><h3 class="text-xl font-semibold text-red-700 mb-3">${item.title}</h3><p class="text-gray-700 mb-2"><strong>ผลกระทบ:</strong> ${item.description}</p><p class="text-gray-700"><strong>การลดผลกระทบ:</strong> ${item.mitigation}</p></div>`).join(''); }
    function renderRecommendations() { const container = document.getElementById('recommendations-container'); if (!container) return; container.innerHTML = recommendationsData.map(rec => `<div class="bg-blue-50 p-4 rounded-lg border border-blue-200 flex items-start space-x-3"><span class="text-blue-600 text-lg">💡</span><p class="text-gray-700">${rec}</p></div>`).join(''); }
    
    // --- Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeApplication();

        // Add resize listener for timeline responsiveness
        window.addEventListener('resize', renderProjectTimeline);

        // Navigation active state logic
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + entry.target.id) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, { root: null, rootMargin: '0px', threshold: 0.5 });
        sections.forEach(section => { observer.observe(section); });
    });
</script>
</body>
</html>
