<!DOCTYPE html>
<html lang="th" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แผนอัปเกรดระบบ NetIQ Access Manager - ไปรษณีย์ไทย</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fbff; /* Very light blue background */
            color: #3f3f46;
        }
        .bg-primary-blue { background-color: #0D94E8; } /* Busisoft header blue */
        .text-primary-blue { color: #0D94E8; }
        .border-primary-blue { border-color: #0D94E8; }
        .hover-bg-primary-blue-dark { background-color: #1A73E8; } /* Slightly darker blue for hover */

        .bg-medium-blue { background-color: #2196F3; } /* Material Blue 500 */
        .text-medium-blue { color: #2196F3; }

        .bg-light-blue { background-color: #E3F2FD; } /* Material Blue 50 */
        .text-light-blue { color: #E3F2FD; }

        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            font-weight: 600; /* Make navigation links bold */
        }
        .nav-link:hover {
            color: #2196F3; /* Medium Blue on hover */
        }
        .nav-link.active {
            color: #0D94E8; /* Primary Blue for active */
            border-bottom-color: #0D94E8;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2196F3;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Timeline specific styles - Reverted to a simpler, more robust flexbox approach */
        .project-timeline {
            position: relative;
            width: 100%;
            overflow-x: auto; /* Enables horizontal scrolling */
            padding-bottom: 20px;
            margin-top: 20px;
        }
        .timeline-header {
            display: flex;
            margin-bottom: 10px;
            font-size: 0.875rem; /* text-sm */
            color: #6b7280; /* gray-500 */
        }
        .timeline-header-spacer {
            flex-shrink: 0;
            width: 270px; /* Matches label area width */
        }
        .timeline-axis-content {
            display: flex;
            flex-grow: 1;
            justify-content: space-between;
            box-sizing: border-box;
            padding-right: 10px; /* Match right padding of bars */
        }
        .timeline-axis-month {
            text-align: center;
            flex-shrink: 0;
            white-space: nowrap;
        }
        .timeline-tracks-container {
            /* This div wraps all individual timeline tracks */
            /* Its width will be set by JS to enable scrolling */
        }
        .timeline-track {
            display: flex; /* Use flex for label + chart area */
            align-items: center;
            height: 40px;
            margin-bottom: 10px;
            background-color: #f3f4f6; /* gray-100 */
            border-radius: 5px;
            box-sizing: border-box;
            /* width will be set by JS */
        }
        .timeline-label-area {
            flex-shrink: 0;
            width: 250px; /* Fixed width for the label area */
            padding-left: 10px;
            padding-right: 10px;
            text-align: right; /* Align text to the right for clarity */
            font-size: 0.875rem;
            color: #3f3f46;
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
            box-sizing: border-box;
            word-break: break-word;
            display: flex; /* For vertical centering */
            align-items: center;
            justify-content: flex-end;
            background-color: #e6eeff; /* Light blue for labels */
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
        }
        .timeline-chart-area {
            flex-grow: 1; /* Takes remaining space in flex container */
            position: relative; /* Container for absolute positioned bars */
            height: 100%; /* Take full height of track */
            min-width: 0; /* Allows shrinking in flex context */
            box-sizing: border-box;
        }
        .timeline-bar {
            height: 30px;
            border-radius: 3px;
            position: absolute; /* Positioned within timeline-chart-area */
            top: 50%; /* Center vertically */
            transform: translateY(-50%); /* Adjust for its own height */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: white;
            padding: 0 5px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 5;
        }
        .timeline-bar.status-NotStarted { background-color: #9ca3af; /* gray-400 */ }
        .timeline-bar.status-InProgress { background-color: #2196F3; /* medium-blue */ }
        .timeline-bar.status-Completed { background-color: #10b981; /* green-500 */ }

        /* Other section styles remain the same */
        th {
            white-space: nowrap;
            padding: 12px 24px;
        }
        td {
            padding: 16px 24px;
        }
        #progress-table-body td:nth-child(2) {
            white-space: normal;
            word-break: break-word;
            min-width: 400px;
        }
        .version-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .version-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .version-card.active {
            border-color: #0D94E8;
            background-color: #E3F2FD;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-xl font-bold text-primary-blue">ไปรษณีย์ไทย</div>
            <div class="hidden md:flex space-x-8">
                <a href="#overview" class="nav-link border-b-2 border-transparent">ภาพรวม</a>
                <a href="#progress" class="nav-link border-b-2 border-transparent">ความคืบหน้า</a>
                <a href="#improvements" class="nav-link border-b-2 border-transparent">การปรับปรุง</a>
                <a href="#version-details" class="nav-link border-b-2 border-transparent">รายละเอียดเวอร์ชัน</a>
                <a href="#benefits" class="nav-link border-b-2 border-transparent">ประโยชน์</a>
                <a href="#risks" class="nav-link border-b-2 border-transparent">ความเสี่ยง</a>
                <a href="#approval" class="nav-link border-b-2 border-transparent">ข้อเสนอแนะ</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8 md:py-12">

        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">แผนอัปเกรดระบบ NetIQ Access Manager (NAM)</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">ยกระดับความปลอดภัยและประสิทธิภาพการเข้าถึงระบบสารสนเทศ พร้อมบูรณาการ NetIQ Advanced Authentication (AA) เพื่ออนาคตที่มั่นคง</p>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ภาพรวมโครงการ</h2>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">สถานะปัจจุบันของระบบ</h3>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Access Manager (NAM):</strong> เวอร์ชัน 4.5.3, ระบบปฏิบัติการ SUSE Linux 12 SP4</div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>สถานะ NAM:</strong> <span class="font-bold text-blue-700">อยู่ระหว่างการ Clone Server</span> (เริ่มต้นขั้นตอนที่ 1)</div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Advanced Authentication (AA):</strong> <span class="font-bold text-green-600">ดำเนินการเสร็จสิ้นเรียบร้อยแล้ว</span></div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>ข้อจำกัดเดิม:</strong> อาจมีช่องโหว่ความปลอดภัยที่ยังไม่ถูกแก้ไข, ขาดคุณสมบัติใหม่ๆ, และส่วนประกอบพื้นฐานเริ่มล้าสมัย</div></li>
                    </ul>
                </div>
                <div class="bg-primary-blue text-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold mb-4">เป้าหมายโครงการ</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>เวอร์ชัน NAM เป้าหมาย:</strong> NetIQ Access Manager 5.1</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>ระบบปฏิบัติการเป้าหมาย:</strong> SUSE Linux 12 SP5</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>การบูรณาการ:</strong> เพิ่ม NetIQ Advanced Authentication (AA) สำหรับ MFA และ Adaptive Authentication</div></li>
                        <li class="flex items-start"><span class="text-light-blue mr-3 mt-1">✔</span><div><strong>ผลลัพธ์:</strong> ระบบที่ปลอดภัย ทันสมัย เสถียร และพร้อมสำหรับอนาคต</div></li>
                    </ul>
                </div>
            </div>
            <p class="text-center mt-8 text-gray-600">โครงการนี้มีเป้าหมายเพื่อทำให้ระบบจัดการการเข้าถึง (NAM) ของไปรษณีย์ไทยทันสมัยขึ้น เพื่อให้ระบบมีความปลอดภัยและทำงานได้ดียิ่งขึ้น นอกจากนี้ เราจะเพิ่ม NetIQ Advanced Authentication (AA) เข้ามา เพื่อเสริมความปลอดภัยในการยืนยันตัวตนให้มีหลายชั้น (MFA) และสามารถปรับระดับความปลอดภัยตามความเสี่ยงได้</p>
        </section>

        <!-- Progress Tracking Section -->
        <section id="progress" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">การติดตามความคืบหน้าแผนการอัปเกรด</h2>
            
            <div class="overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-light-blue">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ลำดับ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ขั้นตอน</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">ผู้รับผิดชอบ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">วันที่เริ่มต้น</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">วันที่สิ้นสุด</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">สถานะ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Action</th>
                        </tr>
                    </thead>
                    <tbody id="progress-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Progress rows will be rendered here by JS -->
                    </tbody>
                </table>
            </div>

            <h3 class="text-2xl font-bold text-center mt-12 mb-8">แผนภาพ Timeline โครงการ</h3>
            <div id="project-timeline" class="relative bg-white rounded-xl shadow-lg border border-gray-100 p-6 overflow-hidden">
                <!-- Outer container to enable scrolling for the entire timeline chart -->
                <div class="project-timeline">
                    <!-- Header for the timeline chart area -->
                    <div class="timeline-header">
                        <div class="timeline-header-spacer"></div> <!-- Spacer for labels -->
                        <div id="timeline-axis-content" class="timeline-axis-content">
                            <!-- Month labels will be injected here -->
                        </div>
                    </div>
                    <!-- Container for all task tracks -->
                    <div id="timeline-tracks-container" class="timeline-tracks-container">
                        <!-- Individual timeline tracks will be injected here -->
                    </div>
                </div>
            </div>

        </section>
        
        <!-- Improvements Chart Section -->
        <section id="improvements" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-4">การปรับปรุงที่สำคัญ</h2>
            <p class="text-center max-w-2xl mx-auto mb-12 text-gray-600">การอัปเกรดครั้งนี้มุ่งเน้นการพัฒนาใน 3 ด้านหลัก คลิกที่ส่วนของแผนภูมิเพื่อดูรายละเอียด</p>
            <div class="grid lg:grid-cols-2 gap-8 items-center">
                <div class="chart-container">
                    <canvas id="improvementsChart"></canvas>
                </div>
                <div id="improvements-details" class="bg-white p-6 rounded-lg shadow-md border border-gray-100 min-h-[300px]">
                    <p class="text-gray-500 text-center flex items-center justify-center h-full">กรุณาเลือกส่วนในแผนภูมิเพื่อดูข้อมูล...</p>
                </div>
            </div>
        </section>

        <!-- Version Details Section -->
        <section id="version-details" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">รายละเอียดเวอร์ชันระบบ</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="version-selection-area">
                </div>
            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 min-h-[300px]" id="version-details-display">
                <p class="text-gray-500 text-center flex items-center justify-center h-full">กรุณาเลือกเวอร์ชันเพื่อดูรายละเอียด...</p>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="benefits" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ประโยชน์ที่คาดว่าจะได้รับ</h2>
            <div id="benefits-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </section>

        <!-- Risks Section -->
        <section id="risks" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ผลกระทบและความเสี่ยงที่อาจเกิดขึ้น</h2>
            <div id="risks-container" class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-100 space-y-6">
                </div>
        </section>

        <!-- Approval Section -->
        <section id="approval" class="pt-16 -mt-16">
             <h2 class="text-3xl font-bold text-center mb-12">ข้อแนะนำและการอนุมัติ</h2>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-2xl font-semibold mb-6">ข้อแนะนำเพื่อความสำเร็จของโครงการ</h3>
                <div id="recommendations-container" class="space-y-4">
                     </div>
                <div class="mt-12 pt-8 border-t">
                    <h3 class="text-2xl font-semibold mb-4 text-center">การอนุมัติ (บริษัท ไปรษณีย์ไทย จำกัด)</h3>
                    <div class="flex flex-wrap justify-center gap-4 mt-6">
                        <button class="bg-primary-blue text-white font-bold py-3 px-6 rounded-lg hover-bg-primary-blue-dark transition-colors">ดำเนินการทันที</button>
                        <button class="bg-gray-200 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors">ดำเนินการในภายหลัง</button>
                        <button class="bg-red-100 text-red-700 font-bold py-3 px-6 rounded-lg hover:bg-red-200 transition-colors">ไม่ต้องการดำเนินการ</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-4 text-center text-sm">
            <p>โครงการบริการบำรุงรักษาระบบบริหารจัดการการเข้าถึงระบบสารสนเทศ ปณท (IDM)</p>
            <p>Last update | วันที่: 20 มิถุนายน 2568</p>
        </div>
    </footer>

<script type="module">
    // --- Static Data Definitions (All data is now hardcoded) ---
    // Make upgradeSteps a global variable or accessible via window for updateTaskDataAndRenderUI and file operations
    window.upgradeSteps = [ // This array will be updated locally, but not persistently saved
        { id: "step-aa", title: "ติดตั้งและปรับแต่ง NetIQ (AA)", description: "ดำเนินการติดตั้งและปรับแต่ง NetIQ Advanced Authentication เพื่อรองรับการยืนยันตัวตนแบบ MFA และ Adaptive Authentication", version: "AA", startDate: "2025-05-01", endDate: "2025-05-20", status: "Completed", assignee: "Busisoft", order: 0 }, // New AA task
        { id: "step-1", title: "Clone ระบบ NAM ทั้งหมด", description: "สร้างสำเนาของระบบ NAM ปัจจุบัน (v4.5.3) ไปยังสภาพแวดล้อมทดสอบที่แยกออกมา เพื่อให้เราอัปเกรดและทดสอบได้อย่างปลอดภัย ไม่กระทบการทำงานปกติ", version: "v4.5.3", startDate: "2025-06-01", endDate: "2025-06-15", status: "In Progress", assignee: "THP", order: 1 },
        { id: "step-2", title: "อัปเกรด NAM เป็น v4.5.5", description: "อัปเกรด NAM ในระบบแยกเป็น v4.5.5 เพื่อปรับปรุงส่วนประกอบพื้นฐานและแก้ไขปัญหาด้านความปลอดภัยบางประการ", details: ["อัปเดต Tomcat 8.5.72, OpenSSL 1.0.2za, Apache 2.4.51", "แก้ไขปัญหาความปลอดภัยเกี่ยวกับอักขระพิเศษและ SAML"], version: "v4.5.5", startDate: "2025-06-16", endDate: "2025-06-30", status: "Not Started", assignee: "Busisoft", order: 2 },
        { id: "step-3", title: "อัปเกรด SUSE Linux เป็น 12 SP5", description: "การอัปเกรดระบบปฏิบัติการ SUSE Linux เป็น 12 SP5 เป็นสิ่งจำเป็นก่อนอัปเกรด NAM ไป v5.x เพื่อให้ระบบเข้ากันได้ดีและทำงานได้ราบรื่น", details: ["เป็นข้อกำหนดสำคัญ (Prerequisite) สำหรับ NAM v5.x", "ป้องกันปัญหาทางเทคนิคและความเข้ากันได้ของระบบ"], version: "SUSE Linux 12 SP5", startDate: "2025-07-01", endDate: "2025-07-15", status: "Not Started", assignee: "Busisoft", order: 3 },
        { id: "step-4", title: "อัปเกรด NAM เป็น v5.0.3", description: "อัปเกรด NAM ในระบบแยกเป็น v5.0.3 ซึ่งมาพร้อมคุณสมบัติใหม่และการแก้ไขช่องโหว่ที่สำคัญ", details: ["รองรับ Kerberos Privileged Attribute Certificate (PAC)", "แก้ไขช่องโหว่ร้ายแรง Log4j และ Multiple XSS (CVE-2022-26325)", "อัปเดต Tomcat 9.0.65, Apache 2.4.54"], version: "v5.0.3", startDate: "2025-07-16", endDate: "2025-07-31", status: "Not Started", assignee: "Busisoft", order: 4 },
        { id: "step-5", title: "อัปเกรด NAM เป็น v5.1", description: "อัปเกรดสู่เวอร์ชันเป้าหมาย v5.1 ที่มีการปรับปรุงครั้งใหญ่ด้านการจัดการและความปลอดภัย", details: ["หน้าจอจัดการใหม่ (Enhanced Administration Console) บน Angular UI", "ปรับปรุง REST APIs สำหรับการทำงานอัตโนมัติ", "แก้ไขช่องโหว่ Directory traversal, User impersonation และ Multiple XSS"], version: "v5.1", startDate: "2025-08-01", endDate: "2025-08-15", status: "Not Started", assignee: "Busisoft", order: 5 },
        { id: "step-6", title: "ตรวจสอบและทดสอบระบบ", description: "ตรวจสอบและทดสอบระบบ NAM ที่อัปเกรดแล้วอย่างละเอียดในระบบแยก เพื่อให้แน่ใจว่าทุกอย่างทำงานถูกต้องและเสถียร ก่อนที่จะนำไปใช้งานจริง", version: "v5.1", startDate: "2025-08-16", endDate: "2025-08-30", status: "Not Started", assignee: "Busisoft", order: 6 }
    ];

    const improvementsChartData = {
        labels: ['ความปลอดภัย', 'ประสิทธิภาพ', 'คุณสมบัติใหม่'],
        datasets: [{
            data: [60, 25, 15],
            backgroundColor: ['#0D94E8', '#2196F3', '#64B5F6'], /* Blues */
            hoverBackgroundColor: ['#1A73E8', '#1976D2', '#42A5F5'], /* Darker blues for hover */
            borderColor: '#f8fbff',
            borderWidth: 4
        }]
    };
    
    const benefitsData = [
        {
            icon: '🛡️',
            title: 'ความปลอดภัยแข็งแกร่งขึ้น',
            description: 'แก้ไขช่องโหว่สำคัญ รองรับการยืนยันตัวตนสมัยใหม่ และเพิ่ม MFA เพื่อป้องกันการเข้าถึงที่ไม่ได้รับอนุญาต'
        },
        {
            icon: '⚡',
            title: 'ประสิทธิภาพและความเสถียร',
            description: 'อัปเดตส่วนประกอบพื้นฐานทำให้ระบบทำงานเร็วขึ้น ลดความเสี่ยงจากปัญหาทางเทคนิคและมีความน่าเชื่อถือสูง'
        },
        {
            icon: '⚙️',
            title: 'บริหารจัดการง่ายและยืดหยุ่น',
            description: 'ด้วยหน้าจอจัดการใหม่และ REST APIs ที่ดีขึ้น ช่วยลดภาระงานของทีม IT และทำงานอัตโนมัติได้มากขึ้น'
        },
        {
            icon: '🤝',
            title: 'ประสบการณ์ผู้ใช้ที่ดีขึ้น',
            description: 'Single Sign-On (SSO) ที่มีประสิทธิภาพช่วยให้ผู้ใช้เข้าถึงแอปพลิเคชันต่างๆ ได้อย่างราบรื่นและสะดวกสบาย'
        },
        {
            icon: '🌍',
            title: 'รองรับการทำงานยุคใหม่',
            description: 'การเพิ่ม AA ช่วยให้รองรับการทำงานนอกสถานที่ (Mobile Workforce) และการ Login แบบ Offline ได้อย่างปลอดภัย'
        },
        {
            icon: '🚀',
            title: 'พร้อมสำหรับอนาคต',
            description: 'ระบบที่ทันสมัยพร้อมรองรับเทคโนโลยีใหม่ๆ และการเปลี่ยนแปลงทางธุรกิจในอนาคตได้อย่างมั่นใจ'
        }
    ];

    const risksData = [
        {
            title: 'ความซับซ้อนในการดำเนินการ',
            description: 'ระบบ IAM มีความซับซ้อนในการตั้งค่า ซึ่งอาจนำไปสู่ข้อผิดพลาดได้',
            mitigation: 'ดำเนินการแบบขั้นบันไดในระบบแยก (วงปิด) และทดสอบอย่างละเอียดโดยทีมผู้เชี่ยวชาญ'
        },
        {
            title: 'ปัญหาความเข้ากันได้ของระบบ',
            description: 'ส่วนประกอบต่างๆ อาจมีปัญหาความเข้ากันไม่ได้ โดยเฉพาะการอัปเกรดระบบปฏิบัติการ',
            mitigation: 'ปฏิบัติตามข้อกำหนดของผลิตภัณฑ์อย่างเคร่งครัด (เช่น อัปเกรด SUSE Linux ก่อน) และทดสอบการทำงานร่วมกันอย่างละเอียด)'
        },
        {
            title: 'ผลกระทบต่อผู้ใช้งาน',
            description: 'การเปลี่ยนแปลงระบบอาจสร้างความสับสนให้ผู้ใช้งานในช่วงแรก',
            mitigation: 'วางแผนการสื่อสารและจัดทำคู่มือให้ผู้ใช้ทราบล่วงหน้า โดยเฉพาะการเปลี่ยนแปลงเรื่องการยืนยันตัวตน (MFA)'
        }
    ];

    const recommendationsData = [
        "ควรมีการวางแผนโครงการที่ละเอียดรอบคอบ จัดสรรทรัพยากรที่เพียงพอ และบริหารจัดการความเสี่ยงอย่างต่อเนื่อง",
        "การทดสอบในสภาพแวดล้อมแยกควรครอบคลุมทุกด้าน ทั้งการทำงาน ประสิทธิภาพ และความปลอดภัย เพื่อให้มั่นใจก่อนนำไปใช้จริง",
        "ควรมีการสื่อสารที่ชัดเจนไปยังผู้ใช้งานเกี่ยวกับประโยชน์และการเปลี่ยนแปลงที่อาจเกิดขึ้น โดยเฉพาะการนำ MFA มาใช้",
        "หลังการอัปเกรด ควรมีการตรวจสอบประสิทธิภาพและความปลอดภัยของระบบอย่างต่อเนื่อง เพื่อให้มั่นใจว่าระบบทำงานได้ตามที่คาดหวัง"
    ];

    // New data structure for version details
    const versionDetailsData = [
        {
            id: "aa",
            name: "NetIQ Advanced Authentication (AA)",
            summary: "NetIQ Advanced Authentication (AA) ได้รับการติดตั้งและปรับแต่งเพื่อเพิ่มความสามารถในการยืนยันตัวตนขั้นสูง",
            details: [
                "รองรับ Multi-Factor Authentication (MFA) หลากหลายรูปแบบ",
                "เพิ่ม Adaptive Authentication เพื่อปรับระดับความปลอดภัยตามบริบทการเข้าถึง",
                "ปรับปรุงประสบการณ์การเข้าสู่ระบบที่ปลอดภัยและยืดหยู่น"
            ]
        },
        {
            id: "v4.5.3",
            name: "NetIQ Access Manager 4.5.3",
            summary: "เวอร์ชันปัจจุบันของ NAM ที่กำลังใช้งานอยู่",
            details: [
                "ทำงานบนระบบปฏิบัติการ SUSE Linux 12 SP4",
                "อาจมีช่องโหว่ความปลอดภัยที่ยังไม่ถูกแก้ไข (EOL approaching for components)",
                "คุณสมบัติและส่วนประกอบพื้นฐานเริ่มล้าสมัย"
            ]
        },
        {
            id: "v4.5.5",
            name: "NetIQ Access Manager 4.5.5 (Patch)",
            summary: "การอัปเกรดแพตช์แรกเพื่อปรับปรุงพื้นฐานและแก้ไขช่องโหว่เร่งด่วน",
            details: [
                "อัปเดต Tomcat 8.5.72, OpenSSL 1.0.2za, Apache 2.4.51",
                "แก้ไขปัญหาความปลอดภัยเกี่ยวกับอักขระพิเศษ (Special Character Handling)",
                "แก้ไขปัญหา SAML (Security Assertion Markup Language)"
            ]
        },
        {
            id: "v5.0.3",
            name: "NetIQ Access Manager 5.0.3",
            summary: "การอัปเกรดเวอร์ชันหลักที่มาพร้อมคุณสมบัติใหม่และการแก้ไขช่องโหว่ร้ายแรง",
            details: [
                "รองรับ Kerberos Privileged Attribute Certificate (PAC)",
                "แก้ไขช่องโหว่ร้ายแรง Log4j (CVE-2021-44228)",
                "แก้ไขช่องโหว่ Multiple XSS (CVE-2022-26325)",
                "อัปเดต Tomcat 9.0.65, Apache 2.4.54"
            ]
        },
        {
            id: "v5.1",
            name: "NetIQ Access Manager 5.1 (Target Version)",
            summary: "เวอร์ชันเป้าหมายที่มีการปรับปรุงครั้งใหญ่ด้านการจัดการ ความปลอดภัย และ REST APIs",
            details: [
                "หน้าจอจัดการใหม่ (Enhanced Administration Console) บน Angular UI",
                "ปรับปรุง REST APIs สำหรับการทำงานอัตโนมัติ (Automation) และการเชื่อมต่อ",
                "แก้ไขช่องโหว่ Directory traversal, User impersonation, และ Multiple XSS เพิ่มเติม"
            ]
        },
        {
            id: "suse-12-sp5",
            name: "SUSE Linux Enterprise Server 12 SP5",
            summary: "Service Pack ล่าสุดสำหรับ SUSE Linux 12 ที่มาพร้อมกับการอัปเดตด้านความปลอดภัยและประสิทธิภาพของระบบปฏิบัติการ",
            details: [
                "แพตช์ความปลอดภัยล่าสุดและการแก้ไขข้อผิดพลาดสำหรับระบบปฏิบัติการ",
                "การปรับปรุงประสิทธิภาพเพื่อการตอบสนองของระบบที่ดีขึ้น",
                "รองรับฮาร์ดแวร์และไดรเวอร์ที่อัปเดตแล้ว",
                "เพิ่มความเสถียรและความน่าเชื่อถือสำหรับแอปพลิเคชันระดับองค์กรที่สำคัญ"
            ]
        }
    ];

    // --- Function Declarations ---

    /**
     * Initializes the application by rendering all sections.
     * This function now acts as the main entry point after DOMContentLoaded.
     */
    function initializeApplication() {
        renderProgressTable();
        renderProjectTimeline();
        createImprovementsChart();
        renderVersionSelection(); 
        renderBenefits();
        renderRisks();
        renderRecommendations();

        // Set initial selections for improvement details and version details
        updateImprovementsDetails('ความปลอดภัย');
        // Ensure version selection is rendered BEFORE attempting to activate a card
        setTimeout(() => { // Small delay to ensure all cards are in DOM
            const initialVersionCard = document.querySelector(`[data-version-id="v5.1"]`);
            if (initialVersionCard) {
                displayVersionDetails('v5.1', initialVersionCard);
            } else {
                const aaVersionCard = document.querySelector(`[data-version-id="aa"]`);
                if (aaVersionCard) {
                    displayVersionDetails('aa', aaVersionCard);
                }
            }
        }, 100); // Adjust delay if needed
    }

    /**
     * Updates the task data locally and re-renders the UI elements.
     * @param {string} taskId - The ID of the task to update.
     * @param {string} field - The field of the task to update (e.g., 'startDate', 'status').
     * @param {*} value - The new value for the specified field.
     */
    window.updateTaskDataAndRenderUI = (taskId, field, value) => {
        const taskIndex = window.upgradeSteps.findIndex(task => task.id === taskId);
        if (taskIndex > -1) {
            window.upgradeSteps[taskIndex][field] = value;
            window.upgradeSteps[taskIndex].lastUpdatedBy = "Local User";
            window.upgradeSteps[taskIndex].lastUpdated = new Date().toISOString();
        }
        window.upgradeSteps.sort((a, b) => a.order - b.order);
        renderProgressTable();
        renderProjectTimeline();
    };

    /**
     * Renders the progress table based on the current upgradeSteps data.
     */
    function renderProgressTable() {
        const tableBody = document.getElementById('progress-table-body');
        if (!tableBody) return;
        
        tableBody.innerHTML = ''; // Clear existing rows

        const sortedSteps = [...window.upgradeSteps].sort((a, b) => a.order - b.order);

        if (sortedSteps.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">ไม่มีข้อมูลแผนการอัปเกรด</td></tr>';
            return;
        }

        sortedSteps.forEach((step, index) => {
            const row = document.createElement('tr');
            row.classList.add('hover:bg-gray-50');

            let statusColorClass = '';
            switch(step.status) {
                case 'Completed':
                    statusColorClass = 'text-green-600 font-semibold';
                    break;
                case 'In Progress':
                    statusColorClass = 'text-blue-600 font-semibold';
                    break;
                case 'Not Started':
                default:
                    statusColorClass = 'text-gray-500';
                    break;
            }

            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <div class="font-semibold">${step.title}</div>
                    <div class="text-xs text-gray-500">${step.description}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${step.assignee || 'N/A'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <input type="date" value="${step.startDate || ''}" 
                           class="border rounded px-2 py-1 text-sm w-36"
                           onchange="window.updateTaskDataAndRenderUI('${step.id}', 'startDate', this.value)"
                           ${step.id === 'step-aa' ? 'disabled' : ''}>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <input type="date" value="${step.endDate || ''}" 
                           class="border rounded px-2 py-1 text-sm w-36"
                           onchange="window.updateTaskDataAndRenderUI('${step.id}', 'endDate', this.value)"
                           ${step.id === 'step-aa' ? 'disabled' : ''}>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm ${statusColorClass}">
                    <select class="border rounded px-2 py-1 text-sm ${statusColorClass}"
                             onchange="window.updateTaskDataAndRenderUI('${step.id}', 'status', this.value)"
                             ${step.id === 'step-aa' ? 'disabled' : ''}>
                        <option value="Not Started" ${step.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                        <option value="In Progress" ${step.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Completed" ${step.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    </select>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="alert('Last updated by: ${step.lastUpdatedBy || 'N/A'} on ${new Date(step.lastUpdated || '').toLocaleString()}');"
                            class="text-blue-600 hover:text-blue-900 text-xs">Info</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
    window.renderProgressTable = renderProgressTable; // Expose to window

    /**
     * Renders the project timeline based on the current upgradeSteps data.
     * This version completely re-generates the timeline using a simpler absolute positioning approach.
     */
    function renderProjectTimeline() {
        const timelineWrapper = document.getElementById('project-timeline');
        const timelineOuterContainer = timelineWrapper.querySelector('.project-timeline'); // Corrected selector to outer container
        const timelineAxisContainer = timelineWrapper.querySelector('.timeline-axis'); 
        const timelineTracksContainer = timelineWrapper.querySelector('#timeline-tracks');

        if (!timelineOuterContainer || !timelineAxisContainer || !timelineTracksContainer) {
            console.error("Timeline containers not found.");
            return;
        }

        timelineAxisContainer.innerHTML = ''; // Clear previous axis
        timelineTracksContainer.innerHTML = ''; // Clear previous tracks

        if (window.upgradeSteps.length === 0) {
            timelineTracksContainer.innerHTML = '<div class="text-center py-4 text-gray-500">ไม่มีข้อมูล Timeline ที่พร้อมใช้งาน</div>';
            return;
        }

        const sortedSteps = [...window.upgradeSteps].sort((a, b) => a.order - b.order);

        // Determine overall project start and end dates from task data
        const validDates = sortedSteps.filter(s => s.startDate && s.endDate)
                                      .flatMap(s => [new Date(s.startDate).getTime(), new Date(s.endDate).getTime()]);
        
        let projectStartDate;
        let projectEndDate;

        if (validDates.length > 0) {
            projectStartDate = new Date(Math.min(...validDates));
            projectEndDate = new Date(Math.max(...validDates));
        } else {
            // Fallback to a fixed default range if no valid dates are found
            projectStartDate = new Date(2025, 3, 1); // April 1st, 2025 (Month is 0-indexed)
            projectEndDate = new Date(2025, 8, 30); // September 30th, 2025
        }

        // Add a buffer to the end date for better visualization (e.g., 1 month)
        projectEndDate.setMonth(projectEndDate.getMonth() + 1);

        const totalProjectDurationMs = projectEndDate.getTime() - projectStartDate.getTime();
        const pixelsPerMs = 0.00000035; // Adjusted value: More pixels per millisecond to stretch the timeline.

        // Calculate chart area width based on overall duration
        const minChartAreaWidth = 900; // Minimum pixel width for the chart portion (where bars go)
        const calculatedChartWidthPx = totalProjectDurationMs * pixelsPerMs;
        const finalChartWidthPx = Math.max(minChartAreaWidth, calculatedChartWidthPx); 
        
        const labelAreaWidth = 250; // Fixed width for the label area (task titles)

        // Set the width of the main project-timeline container to control the full scrollable width
        timelineOuterContainer.style.width = `${labelAreaWidth + finalChartWidthPx}px`; // Overall width including labels


        // --- Render Axis (monthly labels) ---
        let currentMonth = new Date(projectStartDate.getFullYear(), projectStartDate.getMonth(), 1);
        const monthFormat = { month: 'short', year: 'numeric' };
        let axisContent = '';

        while (currentMonth.getTime() <= projectEndDate.getTime()) {
            const nextMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
            const segmentStartMs = Math.max(currentMonth.getTime(), projectStartDate.getTime());
            const segmentEndMs = Math.min(nextMonth.getTime(), projectEndDate.getTime());
            
            const monthDurationMs = segmentEndMs - segmentStartMs;
            const monthWidthPx = monthDurationMs * pixelsPerMs;

            if (monthWidthPx > 0) {
                axisContent += `<div class="timeline-axis-month" style="width: ${monthWidthPx}px;">${currentMonth.toLocaleString('th-TH', monthFormat)}</div>`;
            }
            currentMonth = nextMonth;
        }
        timelineAxisContainer.innerHTML = axisContent;
        // The axis itself is positioned within the .project-timeline, so its left offset needs to account for the label area
        timelineAxisContainer.style.width = `${finalChartWidthPx}px`; // Axis content width
        timelineAxisContainer.style.marginLeft = `${labelAreaWidth}px`; // Offset axis by label area width


        // --- Render Task Bars ---
        sortedSteps.forEach((step, index) => {
            const track = document.createElement('div');
            track.classList.add('timeline-track');
            track.style.width = `100%`; // Track takes 100% width of timelineOuterContainer

            // Task title label area (positioned absolutely relative to the track)
            const taskLabel = document.createElement('div');
            taskLabel.classList.add('timeline-label-area');
            taskLabel.textContent = step.title;
            track.appendChild(taskLabel);

            // Chart area for the bar (positioned absolutely within the track, offset by labelAreaWidth)
            const chartArea = document.createElement('div');
            chartArea.classList.add('timeline-chart-area');
            chartArea.style.marginLeft = `${labelAreaWidth}px`; // Offset chart area by label width
            chartArea.style.width = `${finalChartWidthPx}px`; // Explicitly set width
            track.appendChild(chartArea);


            const bar = document.createElement('div');
            const stepStartDate = new Date(step.startDate);
            const stepEndDate = new Date(step.endDate);

            if (isNaN(stepStartDate.getTime()) || isNaN(stepEndDate.getTime())) {
                console.warn(`Skipping timeline bar for task ${step.id} due to invalid dates.`);
                timelineTracksContainer.appendChild(track);
                return;
            }

            // Calculate position and width based on milliseconds and pixelsPerMs
            const offsetMs = stepStartDate.getTime() - projectStartDate.getTime();
            const durationMs = stepEndDate.getTime() - stepStartDate.getTime();

            const leftPositionPx = offsetMs * pixelsPerMs;
            const widthPx = durationMs * pixelsPerMs;

            const finalBarWidthPx = Math.max(widthPx, 5); // Ensure a minimum width

            bar.classList.add('timeline-bar', `status-${step.status.replace(/\s/g, '')}`);
            bar.style.left = `${leftPositionPx}px`;
            bar.style.width = `${finalBarWidthPx}px`;
            
            bar.title = `${step.title}\nสถานะ: ${step.status}\nเริ่ม: ${step.startDate}\nสิ้นสุด: ${step.endDate}`; // Tooltip

            chartArea.appendChild(bar);
            timelineTracksContainer.appendChild(track);
        });
    }
    window.renderProjectTimeline = renderProjectTimeline; // Expose to window

    /**
     * Creates the Doughnut chart for improvements using Chart.js.
     */
    function createImprovementsChart() {
        const ctx = document.getElementById('improvementsChart');
        if (!ctx) return;

        // Destroy existing chart instance if it exists to prevent re-initialization issues
        if (window.improvementsChartInstance) {
            window.improvementsChartInstance.destroy();
        }

        const chart = new Chart(ctx, {
            type: 'doughnut',
            data: improvementsChartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                size: 14,
                                family: "'Sarabun', sans-serif"
                            }
                        }
                    },
                    tooltip: {
                        titleFont: { family: "'Sarabun', sans-serif" },
                        bodyFont: { family: "'Sarabun', sans-serif" },
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const i = elements[0].index;
                        const label = improvementsChartData.labels[i];
                        updateImprovementsDetails(label);
                    }
                }
            }
        });
        window.improvementsChartInstance = chart; // Store instance globally
    }
    window.createImprovementsChart = createImprovementsChart; // Expose to window

    /**
     * Updates the details section based on the selected improvement category.
     * @param {string} category - The selected improvement category (e.g., 'ความปลอดภัย').
     */
    function updateImprovementsDetails(category) {
        const container = document.getElementById('improvements-details');
        if (!container) return;

        let content = `
            <h3 class="font-bold text-xl mb-4 text-primary-blue">${category}</h3>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
        `;
        
        switch (category) {
            case 'ความปลอดภัย':
                content += `
                    <li>แก้ไขช่องโหว่ความปลอดภัยที่พบในเวอร์ชันก่อนหน้า (เช่น Log4j, XSS)</li>
                    <li>รองรับการยืนยันตัวตนแบบ Multi-Factor Authentication (MFA) ด้วย NetIQ AA</li>
                    <li>เพิ่มความสามารถในการตรวจสอบและควบคุมการเข้าถึงที่ละเอียดอ่อนยิ่งขึ้น</li>
                    <li>อัปเดตส่วนประกอบพื้นฐาน (Tomcat, OpenSSL, Apache) ให้เป็นเวอร์ชันที่ปลอดภัย</li>
                `;
                break;
            case 'ประสิทธิภาพ':
                content += `
                    <li>ปรับปรุงความเร็วในการประมวลผลและการตอบสนองของระบบ</li>
                    <li>ลดภาระงานของ Server ด้วยการจัดการทรัพยากรที่ดีขึ้น</li>
                    <li>เพิ่มความเสถียรและความน่าเชื่อถือในการทำงานต่อเนื่อง</li>
                `;
                break;
            case 'คุณสมบัติใหม่':
                content += `
                    <li>หน้าจอจัดการผู้ดูแลระบบ (Administration Console) ที่ทันสมัยขึ้นบน Angular UI</li>
                    <li>ปรับปรุงและเพิ่มประสิทธิภาพ REST APIs สำหรับการทำงานอัตโนมัติ</li>
                    <li>รองรับ Kerberos Privileged Attribute Certificate (PAC)</li>
                    <li>บูรณาการกับ NetIQ Advanced Authentication (AA) ได้อย่างสมบูรณ์แบบ</li>
                `;
                break;
            default:
                content += `<li>ไม่พบรายละเอียดสำหรับหมวดหมู่นี้</li>`;
        }
        content += `</ul>`;
        container.innerHTML = content;
    }
    window.updateImprovementsDetails = updateImprovementsDetails; // Expose to window

    /**
     * Renders the version selection cards.
     */
    function renderVersionSelection() {
        const selectionArea = document.getElementById('version-selection-area');
        if (!selectionArea) return;
        selectionArea.innerHTML = ''; // Clear existing cards
        versionDetailsData.forEach(version => {
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('bg-white', 'p-4', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200', 'version-card');
            cardDiv.setAttribute('data-version-id', version.id);
            cardDiv.onclick = () => window.displayVersionDetails(version.id, cardDiv);

            cardDiv.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-1">${version.name}</h3>
                <p class="text-sm text-gray-600">${version.summary}</p>
            `;
            selectionArea.appendChild(cardDiv);
        });
    }
    window.renderVersionSelection = renderVersionSelection; // Expose to window

    /**
     * Displays the details of a selected version.
     * @param {string} versionId - The ID of the version to display.
     * @param {HTMLElement} clickedElement - The HTML element that was clicked.
     */
    function displayVersionDetails(versionId, clickedElement) {
        const displayArea = document.getElementById('version-details-display');
        if (!displayArea) return;

        // Remove active class from all version cards
        document.querySelectorAll('.version-card').forEach(card => {
            card.classList.remove('active');
        });
        // Add active class to the clicked card
        if (clickedElement) {
            clickedElement.classList.add('active');
        } else {
            // If no clickedElement is provided (e.g., on initial load), find it
            const cardToActivate = document.querySelector(`[data-version-id="${versionId}"]`);
            if (cardToActivate) {
                cardToActivate.classList.add('active');
            }
        }

        const selectedVersion = versionDetailsData.find(v => v.id === versionId);

        if (selectedVersion) {
            let content = `
                <h3 class="font-bold text-xl mb-4 text-primary-blue">${selectedVersion.name}</h3>
                <p class="text-gray-700 mb-4">${selectedVersion.summary}</p>
                <h4 class="font-semibold text-lg text-gray-800 mb-2">รายละเอียด:</h4>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
            `;
            selectedVersion.details.forEach(detail => {
                content += `<li>${detail}</li>`;
            });
            content += `</ul>`;
            displayArea.innerHTML = content;
        } else {
            displayArea.innerHTML = `<p class="text-red-500 text-center">ไม่พบรายละเอียดสำหรับเวอร์ชันนี้</p>`;
        }
    }
    window.displayVersionDetails = displayVersionDetails; // Expose to window

    /**
     * Renders the benefits section.
     */
    function renderBenefits() {
        const container = document.getElementById('benefits-container');
        if (!container) return;
        container.innerHTML = benefitsData.map(item => `
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex items-start space-x-4">
                <div class="text-4xl leading-none">${item.icon}</div>
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">${item.title}</h3>
                    <p class="text-gray-600">${item.description}</p>
                </div>
            </div>
        `).join('');
    }
    window.renderBenefits = renderBenefits; // Expose to window

    /**
     * Renders the risks section.
     */
    function renderRisks() {
        const container = document.getElementById('risks-container');
        if (!container) return;
        container.innerHTML = risksData.map(item => `
            <div class="p-6 rounded-lg bg-red-50 border border-red-200">
                <h3 class="text-xl font-semibold text-red-700 mb-3">${item.title}</h3>
                <p class="text-gray-700 mb-2"><strong>ผลกระทบ:</strong> ${item.description}</p>
                <p class="text-gray-700"><strong>การลดผลกระทบ:</strong> ${item.mitigation}</p>
            </div>
        `).join('');
    }
    window.renderRisks = renderRisks; // Expose to window

    /**
     * Renders the recommendations section.
     */
    function renderRecommendations() {
        const container = document.getElementById('recommendations-container');
        if (!container) return;
        container.innerHTML = recommendationsData.map(rec => `
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 flex items-start space-x-3">
                <span class="text-blue-600 text-lg">💡</span>
                <p class="text-gray-700">${rec}</p>
            </div>
        `).join('');
    }
    window.renderRecommendations = renderRecommendations; // Expose to window

    // --- Event Listeners (after DOMContentLoaded) ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeApplication(); // Call the main initialization function

        // --- Navigation active state logic ---
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');

        const observerOptions = {
            root: null, // relative to the viewport
            rootMargin: '0px',
            threshold: 0.5 // Trigger when 50% of the section is visible
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.remove('active'); // Remove active from all
                        if (link.getAttribute('href') === '#' + entry.target.id) {
                            link.classList.add('active'); // Add active to current section's link
                        }
                    });
                }
            });
        }, observerOptions);

        // Observe each section
        sections.forEach(section => {
            observer.observe(section);
        });

        // Set active for initial load based on URL hash or default to overview
        if (window.location.hash) {
            const initialHash = window.location.hash.substring(1);
            const initialNavLink = document.querySelector(`.nav-link[href="#${initialHash}"]`);
            if (initialNavLink) {
                initialNavLink.classList.add('active');
            }
        } else {
            // Default to overview if no hash
            const overviewLink = document.querySelector('.nav-link[href="#overview"]');
            if (overviewLink) {
                overviewLink.classList.add('active');
            }
        }

    });
</script>
</body>
</html>
