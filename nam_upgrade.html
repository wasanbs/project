<!DOCTYPE html>
<html lang="th" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แผนอัปเกรดระบบ NetIQ Access Manager - ไปรษณีย์ไทย</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fbff;
            color: #3f3f46;
        }
        .bg-primary-blue { background-color: #0D94E8; }
        .text-primary-blue { color: #0D94E8; }
        .border-primary-blue { border-color: #0D94E8; }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            font-weight: 600;
        }
        .nav-link:hover { color: #2196F3; }
        .nav-link.active {
            color: #0D94E8;
            border-bottom-color: #0D94E8;
        }
        .timeline-bar.status-NotStarted { background-color: #9ca3af; }
        .timeline-bar.status-InProgress { background-color: #2196F3; }
        .timeline-bar.status-Completed { background-color: #10b981; }
        .version-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .version-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .version-card.active {
            border-color: #0D94E8;
            background-color: #E3F2FD;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-xl font-bold text-primary-blue">ไปรษณีย์ไทย</div>
            <div class="hidden md:flex space-x-8">
                <a href="#overview" class="nav-link border-b-2 border-transparent">ภาพรวม</a>
                <a href="#progress" class="nav-link border-b-2 border-transparent">ความคืบหน้า</a>
                <a href="#improvements" class="nav-link border-b-2 border-transparent">การปรับปรุง</a>
                <a href="#version-details" class="nav-link border-b-2 border-transparent">รายละเอียดเวอร์ชัน</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-8 md:py-12">

        <!-- Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">แผนอัปเกรดระบบ NetIQ Access Manager (NAM)</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">ปรับปรุงแผนการอัปเกรดสู่เวอร์ชันล่าสุดบนระบบจริง (Production) โดยตรง พร้อมเพิ่มขั้นตอนการติดตามผล (Follow-up) เพื่อสร้างความมั่นใจและลดผลกระทบต่อผู้ใช้งาน</p>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">ภาพรวมโครงการ</h2>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">สถานะปัจจุบันของระบบ</h3>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Access Manager (NAM):</strong> เวอร์ชัน 4.5.3, SUSE Linux 12 SP4</div></li>
                        <li class="flex items-start"><span class="text-blue-500 mr-3 mt-1">●</span><div><strong>NetIQ Advanced Authentication (AA):</strong> <span class="font-bold text-green-600">ดำเนินการเสร็จสิ้น</span></div></li>
                    </ul>
                </div>
                <div class="bg-primary-blue text-white p-8 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-semibold mb-4">เป้าหมายโครงการ</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start"><span class="text-white mr-3 mt-1">✔</span><div><strong>เวอร์ชัน NAM เป้าหมาย:</strong> NetIQ Access Manager 5.1</div></li>
                        <li class="flex items-start"><span class="text-white mr-3 mt-1">✔</span><div><strong>ระบบปฏิบัติการเป้าหมาย:</strong> SUSE Linux 12 SP5</div></li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Progress Tracking Section -->
        <section id="progress" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">การติดตามความคืบหน้าแผนการอัปเกรด</h2>

            <!-- Unified container for Table and Timeline -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                 <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 mb-6" role="alert">
                    <p class="font-bold">คำแนะนำ</p>
                    <p>คุณสามารถแก้ไขข้อมูลในตารางนี้เพื่อดูการเปลี่ยนแปลงได้ชั่วคราว หากต้องการบันทึกการเปลี่ยนแปลงเพื่อเป็นข้อมูลตั้งต้นใหม่ ให้ทำตามขั้นตอนดังนี้:<br>
                    1. เปิด Developer Console (F12) > เลือกแท็บ Console<br>
                    2. พิมพ์คำสั่ง: <code>copy(JSON.stringify(upgradeSteps, null, 2))</code> แล้วกด Enter เพื่อคัดลอกข้อมูลล่าสุด<br>
                    3. นำข้อมูลที่คัดลอกไปใช้ในเครื่องมือ <strong>json_data_manager.html</strong></p>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ลำดับ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ขั้นตอน</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ผู้รับผิดชอบ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่เริ่มต้น</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่สิ้นสุด</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                            </tr>
                        </thead>
                        <tbody id="progress-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- JS will populate this -->
                        </tbody>
                    </table>
                </div>

                <h3 class="text-2xl font-bold text-center mt-12 mb-8 border-t pt-8">แผนภาพ Timeline โครงการ</h3>
                <div id="project-timeline" class="relative">
                    <div class="project-timeline-container" style="position: relative; width: 100%; overflow-x: auto; padding-bottom: 20px;">
                        <div id="timeline-axis" style="display: flex; padding-left: 250px;"></div>
                        <div id="timeline-tracks" style="position: relative;"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Other sections remain unchanged -->
        <section id="improvements" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-4">การปรับปรุงที่สำคัญ</h2>
            <div class="grid lg:grid-cols-2 gap-8 items-center">
                <div><canvas id="improvementsChart"></canvas></div>
                <div id="improvements-details" class="bg-white p-6 rounded-lg shadow-md border min-h-[300px]"></div>
            </div>
        </section>
        <section id="version-details" class="mb-20 pt-16 -mt-16">
            <h2 class="text-3xl font-bold text-center mb-12">รายละเอียดเวอร์ชันระบบ</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="version-selection-area"></div>
            <div class="bg-white p-6 rounded-lg shadow-md border min-h-[300px]" id="version-details-display"></div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-4 text-center text-sm">
            <p>&copy; 2025 Thailand Post. All rights reserved.</p>
        </div>
    </footer>

<script type="module">
    // --- Data Definitions ---
    
    // This is the single source of truth for the initial data.
    // To update the default plan, modify this array directly.
    const defaultUpgradeSteps = [
        { "id": "step-aa", "title": "ติดตั้งและปรับแต่ง NetIQ (AA)", "description": "ดำเนินการติดตั้งและปรับแต่ง NetIQ Advanced Authentication", "version": "AA", "startDate": "2025-05-01", "endDate": "2025-05-20", "status": "Completed", "assignee": "Busisoft", "order": 0 },
        { "id": "step-2-upgrade", "title": "อัปเกรด NAM v4.5.5 (Production)", "description": "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชัน 4.5.5", "version": "v4.5.5", "startDate": "2025-09-08", "endDate": "2025-09-14", "status": "Not Started", "assignee": "Busisoft", "order": 1 },
        { "id": "step-2-followup", "title": "ติดตามผล NAM v4.5.5", "description": "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", "version": "v4.5.5", "startDate": "2025-09-15", "endDate": "2025-09-21", "status": "Not Started", "assignee": "Busisoft/THP", "order": 2 },
        { "id": "step-3-upgrade", "title": "อัปเกรด SUSE Linux 12 SP5 (Production)", "description": "ดำเนินการอัปเกรดระบบปฏิบัติการ SUSE Linux บนระบบจริง", "version": "SUSE Linux 12 SP5", "startDate": "2025-09-22", "endDate": "2025-09-28", "status": "Not Started", "assignee": "Busisoft", "order": 3 },
        { "id": "step-3-followup", "title": "ติดตามผล SUSE Linux 12 SP5", "description": "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", "version": "SUSE Linux 12 SP5", "startDate": "2025-09-29", "endDate": "2025-10-05", "status": "Not Started", "assignee": "Busisoft/THP", "order": 4 },
        { "id": "step-4-upgrade", "title": "อัปเกรด NAM v5.0.3 (Production)", "description": "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชัน 5.0.3", "version": "v5.0.3", "startDate": "2025-10-06", "endDate": "2025-10-12", "status": "Not Started", "assignee": "Busisoft", "order": 5 },
        { "id": "step-4-followup", "title": "ติดตามผล NAM v5.0.3", "description": "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", "version": "v5.0.3", "startDate": "2025-10-13", "endDate": "2025-10-19", "status": "Not Started", "assignee": "Busisoft/THP", "order": 6 },
        { "id": "step-5-upgrade", "title": "อัปเกรด NAM v5.1 (Production)", "description": "ดำเนินการอัปเกรด NAM บนระบบจริงเป็นเวอร์ชันเป้าหมาย 5.1", "version": "v5.1", "startDate": "2025-10-20", "endDate": "2025-10-26", "status": "Not Started", "assignee": "Busisoft", "order": 7 },
        { "id": "step-5-followup", "title": "ติดตามผล NAM v5.1", "description": "ตรวจสอบและติดตามผลการทำงานของระบบเป็นเวลา 1 สัปดาห์", "version": "v5.1", "startDate": "2025-10-27", "endDate": "2025-11-02", "status": "Not Started", "assignee": "Busisoft/THP", "order": 8 },
        { "id": "step-7-final", "title": "สรุปผลและส่งมอบโครงการ", "description": "รวบรวมข้อมูล สรุปผลการดำเนินงาน และส่งมอบโครงการ", "version": "v5.1", "startDate": "2025-11-03", "endDate": "2025-11-09", "status": "Not Started", "assignee": "Busisoft", "order": 9 }
    ];

    // Main data variable for UI interaction. It's a copy of the default data.
    window.upgradeSteps = JSON.parse(JSON.stringify(defaultUpgradeSteps));

    // --- Core Application Functions ---
    
    function rerenderAll() {
        renderProgressTable();
        renderProjectTimeline();
    }
    
    function initializeApplication() {
        rerenderAll();
        // The rest of the setup
        // ... (Chart, Version Details etc. are static and don't need to be in this snippet for brevity)
    }

    window.updateTaskDataAndRenderUI = (taskId, field, value) => {
        const taskIndex = window.upgradeSteps.findIndex(task => task.id === taskId);
        if (taskIndex > -1) {
            window.upgradeSteps[taskIndex][field] = value;
        }
        window.upgradeSteps.sort((a, b) => a.order - b.order);
        rerenderAll();
    };

    function renderProgressTable() {
        const tableBody = document.getElementById('progress-table-body');
        if (!tableBody) return;
        tableBody.innerHTML = '';
        const sortedSteps = [...window.upgradeSteps].sort((a, b) => a.order - b.order);
        sortedSteps.forEach((step, index) => {
            const row = document.createElement('tr');
            let statusColorClass = 'text-gray-500';
            if (step.status === 'Completed') statusColorClass = 'text-green-600 font-semibold';
            else if (step.status === 'In Progress') statusColorClass = 'text-blue-600 font-semibold';
            
            row.innerHTML = `
                <td class="px-6 py-4">${index + 1}</td>
                <td class="px-6 py-4">
                    <div class="font-semibold">${step.title}</div>
                    <div class="text-xs text-gray-500">${step.description}</div>
                </td>
                <td class="px-6 py-4">${step.assignee}</td>
                <td class="px-6 py-4">
                    <input type="date" value="${step.startDate}" class="border rounded p-1" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'startDate', this.value)">
                </td>
                <td class="px-6 py-4">
                    <input type="date" value="${step.endDate}" class="border rounded p-1" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'endDate', this.value)">
                </td>
                <td class="px-6 py-4 ${statusColorClass}">
                    <select class="border rounded p-1 ${statusColorClass}" onchange="window.updateTaskDataAndRenderUI('${step.id}', 'status', this.value)">
                        <option value="Not Started" ${step.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                        <option value="In Progress" ${step.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                        <option value="Completed" ${step.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    </select>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function renderProjectTimeline() {
        const timelineAxis = document.getElementById('timeline-axis');
        const timelineTracks = document.getElementById('timeline-tracks');
        const container = timelineAxis.parentElement;
        if (!timelineAxis || !timelineTracks) return;

        timelineAxis.innerHTML = '';
        timelineTracks.innerHTML = '';

        const chartWidth = Math.max(container.offsetWidth - 250, 600); // Responsive width
        
        const validDates = window.upgradeSteps.map(s => new Date(s.startDate).getTime()).concat(window.upgradeSteps.map(s => new Date(s.endDate).getTime()));
        const projectStartDate = new Date(Math.min(...validDates));
        const projectEndDate = new Date(Math.max(...validDates));
        projectEndDate.setMonth(projectEndDate.getMonth() + 1);

        const totalDuration = projectEndDate.getTime() - projectStartDate.getTime();

        // Render Axis
        let currentMonth = new Date(projectStartDate.getFullYear(), projectStartDate.getMonth(), 1);
        while(currentMonth < projectEndDate) {
            const axisLabel = document.createElement('div');
            axisLabel.className = 'text-xs text-gray-500 p-1 border-r';
            axisLabel.textContent = currentMonth.toLocaleDateString('th-TH', { month: 'short', year: 'numeric' });
            
            const nextMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
            const monthDuration = nextMonth.getTime() - currentMonth.getTime();
            axisLabel.style.width = `${(monthDuration / totalDuration) * chartWidth}px`;
            timelineAxis.appendChild(axisLabel);
            currentMonth = nextMonth;
        }

        // Render Tracks
        window.upgradeSteps.forEach(step => {
            const track = document.createElement('div');
            track.className = 'flex items-center h-10 mb-1';
            track.innerHTML = `<div class="w-[250px] text-sm pr-4 text-right truncate">${step.title}</div>`;

            const barContainer = document.createElement('div');
            barContainer.className = 'relative h-full';
            barContainer.style.width = `${chartWidth}px`;

            const bar = document.createElement('div');
            const startDate = new Date(step.startDate);
            const endDate = new Date(step.endDate);
            const offset = (startDate.getTime() - projectStartDate.getTime()) / totalDuration * chartWidth;
            const width = (endDate.getTime() - startDate.getTime()) / totalDuration * chartWidth;
            
            bar.className = `timeline-bar status-${step.status.replace(/\s/g, '')} absolute h-8 top-1 rounded flex items-center justify-center text-white text-xs px-2`;
            bar.style.left = `${offset}px`;
            bar.style.width = `${width}px`;
            bar.textContent = step.title;
            bar.title = `${step.title} (${step.startDate} - ${step.endDate})`;
            
            barContainer.appendChild(bar);
            track.appendChild(barContainer);
            timelineTracks.appendChild(track);
        });
    }

    // --- Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeApplication();
        window.addEventListener('resize', renderProjectTimeline); // Make timeline responsive
    });
</script>
</body>
</html>
